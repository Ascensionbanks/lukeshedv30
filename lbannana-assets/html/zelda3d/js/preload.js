var images = [
  'dungeons/dungeon2.png',
  'dungeons/dungeon3.png',
  'dungeons/dungeon4.png',
  'dungeons/dungeon5.png',
  'dungeons/dungeon6.png',
  'dungeons/dungeon7.png',
  'dungeons/dungeon8.png',
  'dungeons/dungeon9.png',
  'dungeons/dungeon1.png',
    
  'img/title/title-mist.png',
  'img/title/title-rock-solid.png',
  'img/title/title-rock.png',
  'img/title/title-rocktop.png',
  'img/title/title-water.png',
  'img/title/title0-0.png',
  'img/title/title0-1.png',
  'img/title/title0-2.png',
  'img/title/title0-3.png',
  'img/title/title0-4.png',
  'img/title/title0-5.png',
  'img/title/title1-0.png',
  'img/title/title1-1.png',
  'img/title/title1-2.png',
  'img/title/title1-3.png',
  'img/title/title1-4.png',
  'img/title/title1-5.png',
  'img/title/title2-0.png',
  'img/title/title2-1.png',
  'img/title/title2-2.png',
  'img/title/title2-3.png',
  'img/title/title2-4.png',
  'img/title/title2-5.png',
  'img/title/title3-0.png',
  'img/title/title3-1.png',
  'img/title/title3-2.png',
  'img/title/title3-3.png',
  'img/title/title3-4.png',
  'img/title/title3-5.png',
  'img/title/title4-0.png',
  'img/title/title4-1.png',
  'img/title/title4-2.png',
  'img/title/title4-3.png',
  'img/title/title4-4.png',
  'img/title/title4-5.png',
  'img/title/title5-0.png',
  'img/title/title5-1.png',
  'img/title/title5-2.png',
  'img/title/title5-3.png',
  'img/title/title5-4.png',
  'img/title/title5-5.png',
  'img/title/title6-0.png',
  'img/title/title6-1.png',
  'img/title/title6-2.png',
  'img/title/title6-3.png',
  'img/title/title6-4.png',
  'img/title/title6-5.png',
  'img/title/title7-0.png',
  'img/title/title7-1.png',
  'img/title/title7-2.png',
  'img/title/title7-3.png',
  'img/title/title7-4.png',
  'img/title/title7-5.png',
  'img/title/title8-0.png',
  'img/title/title8-1.png',
  'img/title/title8-2.png',
  'img/title/title8-3.png',
  'img/title/title8-4.png',
  'img/title/title8-5.png',
  'img/title/title9-0.png',
  'img/title/title9-1.png',
  'img/title/title9-2.png',
  'img/title/title9-3.png',
  'img/title/title9-4.png',
  'img/title/title9-5.png',
  'img/title/title10-0.png',
  'img/title/title10-1.png',
  'img/title/title10-2.png',
  'img/title/title10-3.png',
  'img/title/title10-4.png',
  'img/title/title10-5.png',
  'img/title/title11-0.png',
  'img/title/title11-1.png',
  'img/title/title11-2.png',
  'img/title/title11-3.png',
  'img/title/title11-4.png',
  'img/title/title11-5.png',
  
  'img/ArcherArrow.png',
  'img/coin.png',
  'img/controller2.png',
  'img/death0.png',
  'img/death1.png',
  'img/death2.png',
  'img/death3.png',
  'img/death4.png',
  'img/dpad.png',
  'img/favicon.gif',
  'img/forest_bush.png',
  'img/forest_knight.png',
  'img/forest_rock_bl.png',
  'img/forest_rock_br.png',
  'img/forest_rock_t.png',
  'img/forest_rock_tl.png',
  'img/forest_rock_tr.png',
  'img/forest_turtle.png',
  'img/grave_bush.png',
  'img/grave_grave.png',
  'img/grave_knight.png',
  'img/heart.png',
  'img/hud-heart.png',
  'img/hud-max-hit-points.png',
  'img/hud-panel-selector.png',
  'img/hud-panel-underworld.png',
  'img/hud-panel.png',
  'img/HurlerEven.png',
  'img/HurlerOdd.png',
  'img/HurlerRock.png',
  'img/icon-mobile-192.png',
  'img/icon-mobile.png',
  'img/intro-text-after.gif',
  'img/intro-text.gif',
  'img/level9.png',
  'img/light-black.png',
  'img/light-fire.png',
  'img/light-lantern.png',
  'img/light-red.png',
  'img/light-star.png',
  'img/lightmap.png',
  'img/link-with-sign.png',
  'img/link.png',
  'img/linkfront.png',
  'img/linkleft.png',
  'img/loading.png',
  'img/logo-share.png',
  'img/OrcBlueEven.png',
  'img/OrcBlueOdd.png',
  'img/OrcOrangeEven.png',
  'img/OrcOrangeOdd.png',
  'img/ow_bush.png',
  'img/ow_cave.png',
  'img/ow_knight.png',
  'img/ow_path.png',
  'img/ow_rock_bl.png',
  'img/ow_rock_br.png',
  'img/ow_rock_t.png',
  'img/ow_rock_tl.png',
  'img/ow_rock_tr.png',
  'img/ow_turtle.png',
  'img/ow_water_bl.png',
  'img/ow_water_br.png',
  'img/ow_water_l.png',
  'img/ow_water_r.png',
  'img/ow_water_t.png',
  'img/ow_water_tl.png',
  'img/ow_water_tr.png',
  'img/shadow-obstacle.png',
  'img/shadow-round.png',
  'img/sprite_boulder.png',
  'img/sprite_linknose.png',
  'img/sprite_linkstab.png',
  'img/sprite_linkstand.png',
  'img/sprite_linkwalk.png',
  'img/sprite_woodensword.png',
  
  'img/chars/char-.png',
  'img/chars/char,.png',
  'img/chars/char!.png',
  'img/chars/charquestion.png',
  'img/chars/char..png',
  'img/chars/char&.png',
  'img/chars/char0.png',
  'img/chars/char1.png',
  'img/chars/char2.png',
  'img/chars/char3.png',
  'img/chars/char4.png',
  'img/chars/char5.png',
  'img/chars/char6.png',
  'img/chars/char7.png',
  'img/chars/char8.png',
  'img/chars/char9.png',
  'img/chars/charA.png',
  'img/chars/charB.png',
  'img/chars/charC.png',
  'img/chars/charD.png',
  'img/chars/charE.png',
  'img/chars/charF.png',
  'img/chars/charG.png',
  'img/chars/charH.png',
  'img/chars/charI.png',
  'img/chars/charJ.png',
  'img/chars/charK.png',
  'img/chars/charL.png',
  'img/chars/charM.png',
  'img/chars/charN.png',
  'img/chars/charO.png',
  'img/chars/charP.png',
  'img/chars/charQ.png',
  'img/chars/charR.png',
  'img/chars/charS.png',
  'img/chars/charT.png',
  'img/chars/chartick.png',
  'img/chars/charU.png',
  'img/chars/charV.png',
  'img/chars/charW.png',
  'img/chars/charX.png',
  'img/chars/charY.png',
  'img/chars/charZ.png',


  'img/sprites/HurlerBlueEven.png',
  'img/sprites/HurlerBlueOdd.png',
  'img/sprites/HurlerRedEven.png',
  'img/sprites/HurlerRedOdd.png',
  'img/sprites/JumperBlueDown.png',
  'img/sprites/JumperBlueUp.png',
  'img/sprites/JumperOrangeDown.png',
  'img/sprites/JumperOrangeUp.png',
  'img/sprites/Octoroc1.png',
  'img/sprites/Octoroc2.png',
  'img/sprites/Spinner.png',
  'img/sprites/TreeBottomLeftBrown.png',
  'img/sprites/TreeBottomLeftGreen.png',
  'img/sprites/TreeBottomRightBrown.png',
  'img/sprites/TreeBottomRightGreen.png',
  'img/sprites/TreeFaceBrown.png',
  'img/sprites/TreeFaceGreen.png',
  'img/sprites/TreeTopLeftBrown.png',
  'img/sprites/TreeTopLeftGreen.png',
  'img/sprites/TreeTopRightBrown.png',
  'img/sprites/TreeTopRightGreen.png',

  'img/sprites2/aquamentusbottomleft.png',
  'img/sprites2/aquamentusbottomleft2.png',
  'img/sprites2/aquamentusbottomright.png',
  'img/sprites2/aquamentusbottomright2.png',
  'img/sprites2/aquamentustopleft.png',
  'img/sprites2/aquamentustopleft2.png',
  'img/sprites2/aquamentustopright.png',
  'img/sprites2/barreddoor.png',
  'img/sprites2/barreddoor1.png',
  'img/sprites2/barreddoortop.png',
  'img/sprites2/barreddoortop1.png',
  'img/sprites2/blank.png',
  'img/sprites2/block_blue.png',
  'img/sprites2/block_gray.png',
  'img/sprites2/block_green.png',
  'img/sprites2/block_lime.png',
  'img/sprites2/block_tan.png',
  'img/sprites2/block.png',
  'img/sprites2/bomb.png',
  'img/sprites2/bombhole.png',
  'img/sprites2/boomerang_blue.png',
  'img/sprites2/boomerang.png',
  'img/sprites2/boomerangflat_blue.png',
  'img/sprites2/boomerangflat.png',
  'img/sprites2/bow.png',
  'img/sprites2/caverock.png',
  'img/sprites2/cloud.png',
  'img/sprites2/cloud2.png',
  'img/sprites2/coinblue.png',
  'img/sprites2/compass.png',
  'img/sprites2/door.png',
  'img/sprites2/fire.png',
  'img/sprites2/fire2.png',
  'img/sprites2/fireball.png',
  'img/sprites2/gel1.png',
  'img/sprites2/gel2.png',
  'img/sprites2/goriya_blue.png',
  'img/sprites2/goriya.png',
  'img/sprites2/goriya2_blue.png',
  'img/sprites2/goriya2.png',
  'img/sprites2/heartblue.png',
  'img/sprites2/heartcontainer.png',
  'img/sprites2/item_woodensword.png',
  'img/sprites2/keese1.png',
  'img/sprites2/keese2.png',
  'img/sprites2/key.png',
  'img/sprites2/leever1.png',
  'img/sprites2/leever2.png',
  'img/sprites2/leever3.png',
  'img/sprites2/leever4.png',
  'img/sprites2/leever5.png',
  'img/sprites2/leeverblue1.png',
  'img/sprites2/leeverblue2.png',
  'img/sprites2/leeverblue3.png',
  'img/sprites2/leeverblue4.png',
  'img/sprites2/leeverblue5.png',
  'img/sprites2/lockeddoor.png',
  'img/sprites2/lockeddoor1.png',
  'img/sprites2/lockeddoortop.png',
  'img/sprites2/lockeddoortop1.png',
  'img/sprites2/map.png',
  'img/sprites2/medicinewoman.png',
  'img/sprites2/merchant.png',
  'img/sprites2/octoroc1.png',
  'img/sprites2/octoroc2.png',
  'img/sprites2/oldman1.png',
  'img/sprites2/oldman2.png',
  'img/sprites2/sprite_linkyay.png',
  'img/sprites2/sprite_linkyay2.png',
  'img/sprites2/stalfos.png',
  'img/sprites2/stalfos2.png',
  'img/sprites2/statue_leftblue.png',
  'img/sprites2/statue_leftcyan.png',
  'img/sprites2/statue_leftgray.png',
  'img/sprites2/statue_leftgreen.png',
  'img/sprites2/statue_leftred.png',
  'img/sprites2/statue_rightblue.png',
  'img/sprites2/statue_rightcyan.png',
  'img/sprites2/statue_rightgray.png',
  'img/sprites2/statue_rightgreen.png',
  'img/sprites2/statue_rightred.png',
  'img/sprites2/statue1.png',
  'img/sprites2/statue2.png',
  'img/sprites2/swordshard-bl.png',
  'img/sprites2/swordshard-br.png',
  'img/sprites2/swordshard-tl.png',
  'img/sprites2/swordshard-tr.png',
  'img/sprites2/trap.png',
  'img/sprites2/triforcepiece.png',
  'img/sprites2/wallmaster1.png',
  'img/sprites2/wallmaster2.png',
  'img/sprites2/whitebrick.png',
  'img/sprites2/whitesword.png',
  'img/sprites2/zola.png',

  'img/sprites3/bubbles.png',
  'img/sprites3/dodongofront.png',
  'img/sprites3/dodongofront2.png',
  'img/sprites3/dodongorear.png',
  'img/sprites3/dodongorear2.png',
  'img/sprites3/forest_pillar_bl.png',
  'img/sprites3/forest_pillar_br.png',
  'img/sprites3/forest_pillar_tl.png',
  'img/sprites3/forest_pillar_tr.png',
  'img/sprites3/forest_totem_b.png',
  'img/sprites3/forest_totem_t.png',
  'img/sprites3/grave_pillar_bl.png',
  'img/sprites3/grave_pillar_br.png',
  'img/sprites3/grave_pillar_tl.png',
  'img/sprites3/grave_pillar_tr.png',
  'img/sprites3/grave_totem_b.png',
  'img/sprites3/grave_totem_t.png',
  'img/sprites3/ow_pillar_bl.png',
  'img/sprites3/ow_pillar_br.png',
  'img/sprites3/ow_pillar_tl.png',
  'img/sprites3/ow_pillar_tr.png',
  'img/sprites3/ow_totem_b.png',
  'img/sprites3/ow_totem_t.png',
  'img/sprites3/raft.png',
  'img/sprites3/rope1.png',
  'img/sprites3/rope2.png',
  'img/sprites3/zol1.png',
  'img/sprites3/zol2.png',
  'img/sprites3/zora.png',

  'img/sprites4/bubble-blue.png',
  'img/sprites4/bubble-red.png',
  'img/sprites4/darknut1.png',
  'img/sprites4/darknut2.png',
  'img/sprites4/dodongo_closed_head.png',
  'img/sprites4/dodongo_closed_tail.png',
  'img/sprites4/dodongo_explode_head.png',
  'img/sprites4/dodongo_explode_tail.png',
  'img/sprites4/dodongo_open_head.png',
  'img/sprites4/dodongo_open_tail.png',
  'img/sprites4/fairy.png',
  'img/sprites4/fairy2.png',
  'img/sprites4/ghini.png',
  'img/sprites4/lynel1.png',
  'img/sprites4/lynel2.png',
  'img/sprites4/lynelblue1.png',
  'img/sprites4/lynelblue2.png',
  'img/sprites4/manhandla_center.png',
  'img/sprites4/manhandla_closed.png',
  'img/sprites4/manhandla_open.png',
  'img/sprites4/sand.png',
  'img/sprites4/sand25.png',
  'img/sprites4/sand50.png',
  'img/sprites4/sand75.png',
  'img/sprites4/stairs.png',
  'img/sprites4/water.png',
  'img/sprites4/whistle.png'
];

var notLoadedBySrc = {};
var totalToLoad = images.length;
var totalLoaded = 0;
var progressDiv = document.getElementById('progress');

function onPreload(e) {
  totalLoaded++;
  var percent = Math.floor(100 * totalLoaded / totalToLoad);
  progressDiv.innerHTML = percent + '%';
  $('progress').style.opacity = 1.2 - (percent / 100);
  next();
}
function onPreloadError(e) {
  // Huh. Must be a network error. Just carry on.
  console.log('PRELOAD ERROR', e);
  totalToLoad--;
  next();
}

function next() {
  if (images.length) {
    var img = document.createElement('img');
    img.onload = onPreload;
    img.onerror = onPreloadError;
    var src = images.shift();
    notLoadedBySrc[src] = true;
    img.src = src;
  } else if (totalLoaded == totalToLoad) {
    if (!game) {
      if (!window.WebGLRenderingContext) {
        $('progress').innerHTML = 'SORRY, YOU NEED WEBGL...<p>TRY A DIFFERENT BROWSER.';
        return;
      }
      game = new ace.Game('game-container');
      $('progress').innerHTML = '99%<p>GENERATING HYRULE...';
    }
  }
}


// Called by the engine when all of the graphics are ready.
function onGraphicsLoaded() {
  $('dpad-panel').className = 'visible';
  $('button-panel').className = 'visible';
  $('game-container').className = 'visible';
  $('progress').style.display = 'none';
}

next();
next();
next();
next();
next();
next();
next();
next();